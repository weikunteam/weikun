<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" 
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="com.great.dao.UserManagerDao">
      <!-- 作者：czk -->
      <!-- 说明：获取所有客户数量 -->
	<select id="getUserCount" resultType="String">
		select 
		count(*) 
		from TB_USER
		<where>
		userType=1 and
		delState=0
            <if test="condition.uPhone!=null and condition.uPhone!=''">and uPhone like "%"#{condition.uPhone}"%" </if>
            <if test="@com.great.util.Ognl@isNotEmpty(condition.applyDateStart)">and registerTime &gt;= #{condition.applyDateStart}  </if>
            <if test="@com.great.util.Ognl@isNotEmpty(condition.applyDateEnd)">and registerTime &lt;= #{condition.applyDateEnd}  </if> 
        </where>
        ORDER BY registerTime DESC
	</select>
      <!-- 作者：czk -->
      <!-- 说明：带条件、分页查询客户信息 -->
	<select id="getUserList" resultMap="resultListUser">
		select 
		*
		from TB_USER  
		<where>
		userType=1 and
		delState=0
            <if test="condition.uPhone!=null and condition.uPhone!=''">and uPhone like "%"#{condition.uPhone}"%" </if>
            <if test="@com.great.util.Ognl@isNotEmpty(condition.applyDateStart)">and registerTime &gt;= #{condition.applyDateStart}  </if>
            <if test="@com.great.util.Ognl@isNotEmpty(condition.applyDateEnd)">and registerTime &lt;= #{condition.applyDateEnd}  </if> 
        </where>
        ORDER BY registerTime DESC
		limit #{queryInitCount}  , #{limit}
	</select>
	
	<resultMap type="com.great.model.UserModel" id="resultListUser">
	 	<id column="userId" property="userId"/>
	 	<result column="uPhone" property="uPhone"/>
		<result column="uPsw" property="uPsw"/>
		<result column="uRecommendAmount" property="uRecommendAmount"/>
		<result column="uRegRecommendPeople" property="uRegRecommendPeople"/>
		<result column="uRecommendCode" property="uRecommendCode"/>
		<result column="uLoginState" property="uLoginState"/>
		<result column="salt" property="salt"/>
		<result column="registerTime" property="registerTime"/>
		<result column="userType" property="userType"/>
		<result column="delState" property="delState"/>
		<result column="userName" property="userName"/>
		<result column="uBackGroundAccount" property="uBackGroundAccount"/>
		<result column="uBackGroundPsw" property="uBackGroundPsw"/>
		<result column="age" property="age"/>
		<result column="job" property="job"/>
	 </resultMap>
      <!-- 作者：czk -->
      <!-- 说明：删除客户信息 -->
	<insert id="deleteUserInfo"  parameterType="java.lang.Integer">
	UPDATE 
	TB_USER 
	SET 
	delState = 1
	where userId=#{deleteUserId}
	</insert>
      <!-- 作者：czk -->
      <!-- 说明：添加单笔客户信息 -->
	<insert id="addUserInfo" parameterType="com.great.model.UserModel">
	INSERT INTO 
	TB_USER
	(uPhone,uPsw,userType) 
	values 
	(#{uPhone},#{uPsw},1)
	</insert>
      <!-- 作者：czk -->
      <!-- 说明：编辑客户信息 -->
	<insert id="editUserInfo" parameterType="com.great.model.UserModel">
	UPDATE 
	TB_USER 
	SET 
	uPhone = #{uPhone} , uPsw = #{uPsw}  
	WHERE 
	userId = #{userId}
	</insert>
      <!-- 作者：czk -->
      <!-- 说明：验证手机号是否存在 -->
	<select id="verifyUserPhone" resultType="String">
		select 
		count(*) 
		from TB_USER
		<where>
		userType=1 and
		delState=0
            <if test="userPhone!=null">and uPhone like "%"#{userPhone}"%" </if>
        </where>
	</select>
      <!-- 作者：czk -->
      <!-- 说明：通过userId获取客户信息 -->
 	<select id="queryUserById"  parameterType="java.lang.Integer"  resultType="com.great.model.UserModel">
		select 
		* 
		from TB_USER
		<where>
		userType=1 and
		delState=0 and 
        userId = #{userId} 
        </where>
	</select>
	
</mapper>
