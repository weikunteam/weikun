<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" 
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="com.great.dao.SalesManManagerDao">
      <!-- 作者：czk -->
      <!-- 说明：获取所有业务员数量 -->
	<select id="getSalesManCount" resultType="String">
		select 
		count(*) 
		from TB_USER
		<where>
		userType=2 and
		delState=0
            <if test="name!=null">and uPhone like "%"#{name}"%" </if>
        </where>
	</select>
      <!-- 作者：czk -->
      <!-- 说明：带条件、分页查询业务员信息 -->
	<select id="getSalesManList" resultMap="resultListSalesMan">
		select 
		userId,
		uPhone,
		uPsw
		from TB_USER  
		<where>
		userType=2 and
		delState=0
            <if test="name!=null">and uPhone like "%"#{name}"%" </if>
        </where>
		limit #{queryInitCount}  , #{limit}
	</select>
	
	<resultMap type="com.great.model.UserModel" id="resultListSalesMan">
	 	<id column="userId" property="userId"/>
	 	<result column="uPhone" property="uPhone"/>
		<result column="uPsw" property="uPsw"/>
		<result column="uRecommendAmount" property="uRecommendAmount"/>
		<result column="uRegRecommendPeople" property="uRegRecommendPeople"/>
		<result column="uRecommendCode" property="uRecommendCode"/>
		<result column="uLoginState" property="uLoginState"/>
	 </resultMap>
      <!-- 作者：czk -->
      <!-- 说明：删除业务员信息 -->
	<insert id="deleteSalesManInfo"  parameterType="java.lang.Integer">
	UPDATE 
	TB_USER 
	SET 
	delState = 1
	where userId=#{deleteSalesManId}
	</insert>
      <!-- 作者：czk -->
      <!-- 说明：添加单笔业务员信息 -->
	<insert id="addSalesManInfo" parameterType="com.great.model.UserModel">
	INSERT INTO 
	TB_USER
	(uPhone,uPsw,userType) 
	values 
	(#{uPhone},#{uPsw},2)
	</insert>
      <!-- 作者：czk -->
      <!-- 说明：编辑业务员信息 -->
	<insert id="editSalesManInfo" parameterType="com.great.model.UserModel">
	UPDATE 
	TB_USER 
	SET 
	uPhone = #{uPhone} , uPsw = #{uPsw}  
	WHERE 
	userId = #{userId}
	</insert>
      <!-- 作者：czk -->
      <!-- 说明：验证手机号是否存在 -->
	<select id="verifySalesManPhone" resultType="String">
		select 
		count(*) 
		from TB_USER
		<where>
		userType=2 and
		delState=0
            <if test="salesManPhone!=null">and uPhone like "%"#{salesManPhone}"%" </if>
        </where>
	</select>
      <!-- 作者：czk -->
      <!-- 说明：通过userId获取业务员信息 -->
 	<select id="querySalesManById"  parameterType="java.lang.Integer"  resultType="com.great.model.UserModel">
		select 
		* 
		from TB_USER
		<where>
		userType=2 and
		delState=0 and 
        userId = #{userId} 
        </where>
	</select>
</mapper>
