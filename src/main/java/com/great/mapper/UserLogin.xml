<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" 
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="com.great.dao.UserLoginDao">
	<select id="getUser" resultType="map">
		select
		userId, 
		uPhone,
		uPsw,
		salt,
		uRecommendCode,
		uRecommendAmount,
		uRegRecommendPeople,
		userName,
		age,
		job,
		userType
		from TB_USER 
		where
		uPhone = #{tel}
	</select>
	
	<insert id="addUser">
	insert into
	  TB_USER (uPhone,uPsw,registerTime,uRecommendCode,salt,uRegRecommendPeople,userType,openId)
	 values
	        (#{tel},#{psw},#{date},#{selfCode},#{salt},#{recommendPeople},'1',#{openId})
	</insert>

    <update id="updatePwd">
        update TB_USER set uPsw = #{psw},salt = #{salt} where uPhone = #{tel}
    </update>

	<select id="getRecommendpeople" resultType="string">
		select userId from TB_USER where uRecommendCode = #{code}
	</select>

	<select id="getUserById" resultType="map">
		select
			userId,
			uPhone,
			uPsw,
			salt,
			uRecommendCode,
			uRecommendAmount,
			uRegRecommendPeople,
			userName,
			age,
			job,
			userType,
			openId,
			(select count(*) from TB_USER where uRegRecommendPeople = #{userId}) AS studentNum
		from TB_USER
		where
			userId = #{userId}
	</select>
	
</mapper>